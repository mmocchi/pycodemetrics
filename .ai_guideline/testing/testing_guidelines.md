# テストガイドライン

## 概要
このドキュメントは、pycodemetricsプロジェクトのテスト規約を定義します。品質の高い、信頼性のあるテストを書くための指針として使用してください。

## テスト環境
- テストフレームワーク: pytest
- カバレッジツール: pytest-cov
- モックライブラリ: pytest-mock

## テスト規約

### 1. テスト構造
- テストファイルは`tests/`ディレクトリに配置
- テストファイル名は`test_*.py`形式
- テスト関数名は`test_*`形式
- テストクラス名は`Test*`形式

### 2. テストカバレッジ
- 最低限のカバレッジ目標: 80%
- カバレッジレポートは`coverage.xml`に出力
- 除外するコード:
  - `__repr__`メソッド
  - デバッグ用の条件分岐
  - `if __name__ == '__main__'`ブロック
  - `raise NotImplementedError`
  - `pass`文
  - `ImportError`の例外処理

### 3. テストの種類
- ユニットテスト: 個々の関数やメソッドのテスト
- 統合テスト: 複数のコンポーネントの連携テスト
- 機能テスト: エンドツーエンドの機能テスト

### 4. テストの書き方
- 各テストは1つの機能のみをテスト
- テスト名は明確で説明的に
- テストデータは適切に分離
- モックは必要な場合のみ使用
- 単体テストにはAAAパターンでテストコードに、Arrange, Act, Assertのブロックがわかるようにコメントを記載すること


### 5. テストのdocstring
下記を参考にdocstringに何を確認するかを明確に記載する

```
    """<何を確認するテストかを明確、かつ簡潔に記載>

    Arrange:
        テスト用のPythonファイルを作成

    Act:
        メトリクス分析を実行

    Assert:
        出力にファイル名が含まれていることを確認
        プロダクトコードとして認識されることを確認
        各メトリクスが出力に含まれていることを確認
        メトリクスの値が数値として出力されていることを確認
    """
```

### 6. フィクスチャ
- 共通のセットアップはフィクスチャを使用
- フィクスチャは適切なスコープで定義
- テストデータはフィクスチャで管理

### 7. アサーション
- 具体的なアサーションメッセージを使用
- 適切なアサーションメソッドを選択
- エッジケースも考慮

### 8. モック
- 外部依存は適切にモックすること
- モックの振る舞いは明確に定義すること
- できるだけ使わず、ブラックボックステストになるようなテストコードにすること

## テスト実行
```bash
# すべてのテストを実行
uv run pytest tests

# カバレッジレポート付きで実行
uv run pytest tests --cov=src/pycodemetrics --cov-report=term-missing --cov-report=xml
```

## ベストプラクティス
1. テストは独立して実行可能であること
2. テストは再現可能であること
3. テストは高速に実行できること
4. テストは保守しやすいこと
5. テストは明確な目的を持つこと

## 禁止事項
- テスト間の依存関係
- 環境依存のテスト
- 非決定的なテスト
- 過度に複雑なテスト
- テストの重複
